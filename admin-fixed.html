<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€å®Œå…¨ä¿®æ­£ç‰ˆã€‘- ãƒ“ãƒ¨ãƒ³ãƒ‰ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ç¥­ã‚Š 2025</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Hiragino Sans', 'Yu Gothic', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1600px; margin: 0 auto; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
.header { background: linear-gradient(135deg, #2c5f2d 0%, #4a7c59 100%); color: white; padding: 30px; text-align: center; }
.header h1 { font-size: 32px; margin-bottom: 10px; }
.nav { padding: 20px; border-bottom: 2px solid #eee; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
.btn { background: #2c5f2d; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
.btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.btn-primary { background: #2c5f2d; }
.btn-add { background: #4a90e2; }
.btn-export { background: #e74c3c; }
.btn-import { background: #9b59b6; }
.btn-images { background: #ff9800; }
.btn-gray { background: #6c757d; }
.section { padding: 30px; }
.status { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #d2691e; padding: 20px; border-radius: 15px; font-size: 18px; font-weight: bold; margin-bottom: 30px; text-align: center; }
.shops-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; margin-top: 20px; }
.shop-card { background: white; border: 2px solid #2c5f2d; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(44,95,45,0.15); position: relative; }
.shop-card h3 { color: #2c5f2d; margin-bottom: 15px; font-size: 20px; }
.shop-info { margin: 10px 0; color: #555; font-size: 14px; line-height: 1.6; }
.shop-thumb { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; position: absolute; top: 20px; right: 20px; border: 2px solid #ddd; }
.shop-actions { margin-top: 15px; display: flex; gap: 10px; }
.btn-edit { background: #4a90e2; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; }
.btn-delete { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; font-size: 14px; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
.form-group textarea { resize: vertical; min-height: 100px; }
.checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
.checkbox-group label { display: flex; align-items: center; font-weight: normal; font-size: 14px; }
.checkbox-group input { width: auto; margin-right: 5px; }
.form-actions { text-align: center; margin-top: 30px; }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto; }
.modal-content { background: white; width: 95%; max-width: 900px; margin: 30px auto; border-radius: 20px; padding: 30px; max-height: 90vh; overflow-y: auto; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
.modal-close { background: none; border: none; font-size: 30px; cursor: pointer; color: #999; }
.success { color: #2c5f2d; }
.error { color: #e74c3c; }
.loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #2c5f2d; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.form-section { border-top: 2px solid #eee; margin-top: 30px; padding-top: 20px; }
.form-section-title { font-size: 18px; color: #2c5f2d; margin-bottom: 15px; font-weight: bold; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€å®Œå…¨ä¿®æ­£ç‰ˆã€‘</h1>
    <p>ãƒ“ãƒ¨ãƒ³ãƒ‰ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ç¥­ã‚Š 2025 - ä¿®æ­£å®Œäº†ï¼</p>
  </div>
  
  <div class="nav">
    <button class="btn btn-primary" onclick="showSection('list')">ğŸ“‹ åº—èˆ—ä¸€è¦§</button>
    <button class="btn btn-add" onclick="showSection('add')">â• æ–°è¦ç™»éŒ²</button>
    <button class="btn btn-export" onclick="exportData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
  </div>
  
  <!-- åº—èˆ—ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="section-list" class="section">
    <div id="status" class="status">
      <span class="loading"></span>
      ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
    </div>
    <div id="shops-grid" class="shops-grid"></div>
  </div>

  <!-- æ–°è¦ç™»éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="section-add" class="section" style="display:none;">
    <h2>æ–°è¦åº—èˆ—ç™»éŒ²</h2>
    <div class="form-group">
      <label for="add-name">åº—èˆ—å *</label>
      <input type="text" id="add-name" required>
    </div>
    <div class="form-group">
      <label for="add-short">çŸ­ã„èª¬æ˜</label>
      <input type="text" id="add-short">
    </div>
    <div class="form-group">
      <label for="add-address">ä½æ‰€</label>
      <input type="text" id="add-address">
    </div>
    <div class="form-group">
      <label for="add-thumb">ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURL</label>
      <input type="url" id="add-thumb">
      <img id="thumb-preview" style="display:none; width: 100px; height: 100px; object-fit: cover; margin-top: 10px; border-radius: 8px;">
    </div>
    <div class="form-actions">
      <button class="btn btn-add" onclick="addShop()">ğŸ“ ç™»éŒ²ã™ã‚‹</button>
      <button class="btn btn-gray" onclick="showSection('list')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>
</div>

<!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="edit-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>åº—èˆ—ç·¨é›†</h2>
      <button class="modal-close" onclick="closeEditModal()">&times;</button>
    </div>
    <input type="hidden" id="edit-id">
    <div class="form-group">
      <label for="edit-name">åº—èˆ—å *</label>
      <input type="text" id="edit-name" required>
    </div>
    <div class="form-group">
      <label for="edit-short">çŸ­ã„èª¬æ˜</label>
      <input type="text" id="edit-short">
    </div>
    <div class="form-group">
      <label for="edit-address">ä½æ‰€</label>
      <input type="text" id="edit-address">
    </div>
    <div class="form-group">
      <label for="edit-thumb">ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURL</label>
      <input type="url" id="edit-thumb">
      <img id="edit-thumb-preview" style="display:none; width: 100px; height: 100px; object-fit: cover; margin-top: 10px; border-radius: 8px;">
    </div>
    <div class="form-actions">
      <button class="btn btn-primary" onclick="updateShop()">ğŸ“ æ›´æ–°ã™ã‚‹</button>
      <button class="btn btn-gray" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://gf-fes-api.bettger1000.workers.dev/api';
let shops = [];

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
  loadShops();
  
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
  document.getElementById('add-thumb').addEventListener('input', function() {
    const preview = document.getElementById('thumb-preview');
    if (this.value && !this.value.endsWith('.svg')) {
      preview.src = this.value;
      preview.style.display = 'block';
      preview.onerror = function() { this.style.display = 'none'; };
    } else {
      preview.style.display = 'none';
    }
  });
  
  document.getElementById('edit-thumb').addEventListener('input', function() {
    const preview = document.getElementById('edit-thumb-preview');
    if (this.value && !this.value.endsWith('.svg')) {
      preview.src = this.value;
      preview.style.display = 'block';
      preview.onerror = function() { this.style.display = 'none'; };
    } else {
      preview.style.display = 'none';
    }
  });
});

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ‡æ›¿
function showSection(sectionName) {
  document.querySelectorAll('.section').forEach(section => {
    section.style.display = 'none';
  });
  document.getElementById('section-' + sectionName).style.display = 'block';
}

// åº—èˆ—ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
function loadShops() {
  fetch(API_BASE + '/shops')
    .then(response => response.json())
    .then(data => {
      shops = data;
      displayShops();
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('status').innerHTML = '<span class="error">âŒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</span>';
    });
}

// åº—èˆ—ä¸€è¦§è¡¨ç¤º
function displayShops() {
  const statusDiv = document.getElementById('status');
  const gridDiv = document.getElementById('shops-grid');
  
  if (!shops || shops.length === 0) {
    statusDiv.innerHTML = '<span class="error">ç™»éŒ²æ¸ˆã¿åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</span>';
    gridDiv.innerHTML = '';
    return;
  }
  
  statusDiv.innerHTML = `<span class="success">âœ… ${shops.length}ä»¶ã®åº—èˆ—ã‚’ç®¡ç†ä¸­</span>`;
  
  let html = '';
  shops.forEach(shop => {
    html += `
      <div class="shop-card">
        ${shop.thumb && !shop.thumb.endsWith('.svg') ? `<img src="${shop.thumb}" alt="${shop.name}" class="shop-thumb" onerror="this.style.display='none'">` : ''}
        <h3>${shop.name || 'åå‰æœªè¨­å®š'}</h3>
        ${shop.short ? `<div class="shop-info">ğŸ“ ${shop.short}</div>` : ''}
        ${shop.address ? `<div class="shop-info">ğŸ“ ${shop.address}</div>` : ''}
        <div class="shop-actions">
          <button class="btn-edit" onclick="editShop('${shop.id}')">âœï¸ ç·¨é›†</button>
          <button class="btn-delete" onclick="deleteShop('${shop.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>
      </div>
    `;
  });
  
  gridDiv.innerHTML = html;
}

// æ–°è¦åº—èˆ—è¿½åŠ 
function addShop() {
  const name = document.getElementById('add-name').value.trim();
  if (!name) {
    alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  const shopData = {
    name: name,
    short: document.getElementById('add-short').value.trim(),
    address: document.getElementById('add-address').value.trim(),
    thumb: document.getElementById('add-thumb').value.trim()
  };
  
  fetch(API_BASE + '/shops', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(shopData)
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
      document.getElementById('add-name').value = '';
      document.getElementById('add-short').value = '';
      document.getElementById('add-address').value = '';
      document.getElementById('add-thumb').value = '';
      document.getElementById('thumb-preview').style.display = 'none';
      loadShops();
      showSection('list');
    } else {
      alert('âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}

// ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function editShop(id) {
  const shop = shops.find(s => s.id === id);
  if (!shop) return;
  
  document.getElementById('edit-id').value = shop.id.toString();
  document.getElementById('edit-name').value = shop.name || '';
  document.getElementById('edit-short').value = shop.short || '';
  document.getElementById('edit-address').value = shop.address || '';
  document.getElementById('edit-thumb').value = shop.thumb || '';
  
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š
  const preview = document.getElementById('edit-thumb-preview');
  if (shop.thumb && !shop.thumb.endsWith('.svg')) {
    preview.src = shop.thumb;
    preview.style.display = 'block';
  } else {
    preview.style.display = 'none';
  }
  
  document.getElementById('edit-modal').style.display = 'block';
}

// åº—èˆ—æ›´æ–°
function updateShop() {
  const id = document.getElementById('edit-id').value.split(':')[0]; // IDä¿®æ­£
  const name = document.getElementById('edit-name').value.trim();
  
  if (!name) {
    alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  const shopData = {
    name: name,
    short: document.getElementById('edit-short').value.trim(),
    address: document.getElementById('edit-address').value.trim(),
    thumb: document.getElementById('edit-thumb').value.trim()
  };
  
  fetch(API_BASE + '/shops/' + id, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(shopData)
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
      closeEditModal();
      loadShops();
    } else {
      alert('âŒ æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}

// åº—èˆ—å‰Šé™¤
function deleteShop(id) {
  const shop = shops.find(s => s.id === id);
  if (!shop) return;
  
  if (!confirm(`ã€Œ${shop.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
    return;
  }
  
  fetch(API_BASE + '/shops/' + id.split(':')[0], { // IDä¿®æ­£
    method: 'DELETE'
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
      loadShops();
    } else {
      alert('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
function closeEditModal() {
  document.getElementById('edit-modal').style.display = 'none';
}

// ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
function exportData() {
  const dataStr = JSON.stringify(shops, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'shops_data.json';
  link.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>