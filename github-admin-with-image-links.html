<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€ç”»åƒãƒªãƒ³ã‚¯é›†å¯¾å¿œã€‘- ãƒ“ãƒ¨ãƒ³ãƒ‰ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ç¥­ã‚Š 2025</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Hiragino Sans', 'Yu Gothic', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1600px; margin: 0 auto; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
.header { background: linear-gradient(135deg, #2c5f2d 0%, #4a7c59 100%); color: white; padding: 30px; text-align: center; }
.header h1 { font-size: 32px; margin-bottom: 10px; }
.nav { padding: 20px; border-bottom: 2px solid #eee; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
.btn { background: #2c5f2d; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
.btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.btn-primary { background: #2c5f2d; }
.btn-add { background: #4a90e2; }
.btn-export { background: #e74c3c; }
.btn-import { background: #9b59b6; }
.btn-images { background: #ff9800; }
.btn-gray { background: #6c757d; }
.section { padding: 30px; }
.status { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #d2691e; padding: 20px; border-radius: 15px; font-size: 18px; font-weight: bold; margin-bottom: 30px; text-align: center; }
.shops-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; margin-top: 20px; }
.shop-card { background: white; border: 2px solid #2c5f2d; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(44,95,45,0.15); position: relative; }
.shop-card h3 { color: #2c5f2d; margin-bottom: 15px; font-size: 20px; }
.shop-info { margin: 10px 0; color: #555; font-size: 14px; line-height: 1.6; }
.shop-thumb { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; position: absolute; top: 20px; right: 20px; border: 2px solid #ddd; }
.shop-actions { margin-top: 15px; display: flex; gap: 10px; }
.btn-edit { background: #4a90e2; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; }
.btn-delete { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; font-size: 14px; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
.form-group textarea { resize: vertical; min-height: 100px; }
.checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
.checkbox-group label { display: flex; align-items: center; font-weight: normal; font-size: 14px; }
.checkbox-group input { width: auto; margin-right: 5px; }
.form-actions { text-align: center; margin-top: 30px; }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto; }
.modal-content { background: white; width: 95%; max-width: 900px; margin: 30px auto; border-radius: 20px; padding: 30px; max-height: 90vh; overflow-y: auto; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
.modal-close { background: none; border: none; font-size: 30px; cursor: pointer; color: #999; }
.success { color: #2c5f2d; }
.error { color: #e74c3c; }
.loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #2c5f2d; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.form-section { border-top: 2px solid #eee; margin-top: 30px; padding-top: 20px; }
.form-section-title { font-size: 18px; color: #2c5f2d; margin-bottom: 15px; font-weight: bold; }

/* ç”»åƒãƒªãƒ³ã‚¯é›†å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.image-links-section { background: linear-gradient(135deg, #f3e5f5, #e1bee7); border: 3px solid #9c27b0; border-radius: 15px; padding: 25px; margin-bottom: 30px; }
.image-links-title { color: #6a1b9a; font-size: 24px; font-weight: bold; margin-bottom: 20px; text-align: center; }
.image-upload-area { background: white; border: 3px dashed #9c27b0; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: all 0.3s; }
.image-upload-area:hover { border-color: #7b1fa2; background: #f9f9f9; }
.image-upload-area.dragover { border-color: #4a148c; background: #f3e5f5; transform: scale(1.02); }
.upload-icon { font-size: 48px; margin-bottom: 15px; color: #9c27b0; }
.upload-text { font-size: 18px; color: #6a1b9a; font-weight: bold; }
.upload-subtitle { font-size: 14px; color: #888; margin-top: 8px; }
.image-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
.image-item { position: relative; border: 2px solid #ddd; border-radius: 12px; overflow: hidden; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: all 0.3s; }
.image-item:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
.image-preview { width: 100%; height: 120px; object-fit: cover; }
.image-info { padding: 15px; }
.image-url { font-size: 12px; color: #666; word-break: break-all; margin-bottom: 10px; background: #f5f5f5; padding: 8px; border-radius: 6px; }
.image-actions { display: flex; gap: 8px; justify-content: center; }
.btn-copy { background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
.btn-copy:hover { background: #45a049; }
.btn-copy.copied { background: #2196f3; }
.btn-remove-img { background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 12px; }
.images-stats { background: #e8f5e8; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: center; color: #2e7d32; font-weight: bold; }
.quick-paste { display: flex; gap: 10px; margin-top: 15px; align-items: center; }
.quick-paste input { flex: 1; padding: 10px; border: 2px solid #9c27b0; border-radius: 8px; }
.quick-paste button { background: #9c27b0; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }
.copy-success { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #4caf50; color: white; padding: 15px 25px; border-radius: 25px; font-weight: bold; z-index: 2000; animation: fadeInOut 2s ease-in-out; }
@keyframes fadeInOut { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } 50% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€ç”»åƒãƒªãƒ³ã‚¯é›†å¯¾å¿œã€‘</h1>
    <p>ãƒ“ãƒ¨ãƒ³ãƒ‰ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ç¥­ã‚Š 2025 - ç”»åƒç®¡ç†ã‚’ç°¡å˜ã«ï¼</p>
  </div>
  
  <div class="nav">
    <button class="btn btn-primary" onclick="showSection('list')">ğŸ“‹ åº—èˆ—ä¸€è¦§</button>
    <button class="btn btn-add" onclick="showSection('add')">â• æ–°è¦ç™»éŒ²</button>
    <button class="btn btn-images" onclick="showSection('images')">ğŸ“· ç”»åƒãƒªãƒ³ã‚¯é›†</button>
    <button class="btn btn-import" onclick="document.getElementById('import-file').click()">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
    <button class="btn btn-export" onclick="exportData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importData(event)">
  </div>
  
  <!-- åº—èˆ—ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="section-list" class="section">
    <div id="status" class="status">
      <span class="loading"></span>
      åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
    </div>
    <div id="shops-grid" class="shops-grid"></div>
  </div>
  
  <!-- ç”»åƒãƒªãƒ³ã‚¯é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="section-images" class="section" style="display:none;">
    <div class="image-links-section">
      <div class="image-links-title">ğŸ“· ç”»åƒãƒªãƒ³ã‚¯é›† - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ & ç®¡ç†</div>
      
      <div class="images-stats" id="images-stats">
        ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ç”»åƒ: <span id="image-count">0</span>æš | ä»Šã™ãä½¿ãˆã‚‹URLé›†
      </div>
      
      <!-- GitHub Issues ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
      <div class="image-upload-area" onclick="window.open('https://github.com/bettger3000/gf-admin/issues/new', '_blank')">
        <div class="upload-icon">ğŸ“·</div>
        <div class="upload-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦GitHub Issuesã§ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        <div class="upload-subtitle">è¤‡æ•°ç”»åƒã‚’ä¸€åº¦ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ | ç„¡æ–™ãƒ»ç„¡åˆ¶é™</div>
      </div>
      
      <!-- æ‰‹å‹•URLè¿½åŠ  -->
      <div class="quick-paste">
        <input type="text" id="manual-url-input" placeholder="ç”»åƒURLã‚’ç›´æ¥å…¥åŠ›ï¼ˆhttps://user-images.githubusercontent.com/...ï¼‰">
        <button onclick="addManualURL()">â• è¿½åŠ </button>
      </div>
      
      <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
      <div id="image-gallery" class="image-gallery"></div>
    </div>
  </div>
  
  <!-- æ–°è¦ç™»éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="section-add" class="section" style="display:none;">
    <h2 style="text-align:center;color:#2c5f2d;margin-bottom:30px;">æ–°è¦åº—èˆ—ç™»éŒ²</h2>
    
    <!-- ç”»åƒã‚¯ã‚¤ãƒƒã‚¯é¸æŠ -->
    <div style="background:#e8f5e8;border-radius:12px;padding:20px;margin-bottom:30px;">
      <h3 style="color:#2e7d32;margin-bottom:15px;">ğŸ“· ç”»åƒã‚¯ã‚¤ãƒƒã‚¯é¸æŠ</h3>
      <p style="color:#666;margin-bottom:15px;">ç”»åƒãƒªãƒ³ã‚¯é›†ã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€ä¸‹ã®æ¬„ã«ç›´æ¥URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      <button type="button" onclick="showImageSelector()" style="background:#4caf50;color:white;border:none;padding:10px 20px;border-radius:20px;cursor:pointer;">ğŸ“· ç”»åƒãƒªãƒ³ã‚¯é›†ã‹ã‚‰é¸æŠ</button>
    </div>
    
    <form id="add-form" style="max-width:900px;margin:0 auto;">
      
      <!-- åŸºæœ¬æƒ…å ± -->
      <div class="form-section-title">ğŸ“ åŸºæœ¬æƒ…å ±</div>
      <div class="form-row">
        <div class="form-group">
          <label>åº—èˆ—å *</label>
          <input type="text" id="add-name" required>
        </div>
        <div class="form-group">
          <label>ç°¡æ½”ãªèª¬æ˜</label>
          <input type="text" id="add-short" placeholder="ä¾‹: ç±³ç²‰ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­ã®å°‚é–€åº—">
        </div>
      </div>
      
      <div class="form-group">
        <label>ã‚³ãƒ³ã‚»ãƒ—ãƒˆ</label>
        <textarea id="add-concept" placeholder="ãŠåº—ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚„æƒ³ã„"></textarea>
      </div>

      <div class="form-group">
        <label>è©³ç´°èª¬æ˜</label>
        <textarea id="add-desc" placeholder="ãŠåº—ã®è©³ã—ã„èª¬æ˜"></textarea>
      </div>

      <div class="form-group">
        <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®¢å±¤</label>
        <textarea id="add-targetCustomer" placeholder="ã©ã®ã‚ˆã†ãªãŠå®¢æ§˜ã«æ¥ã¦ã„ãŸã ããŸã„ã‹"></textarea>
      </div>

      <div class="form-group">
        <label>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ»èƒŒæ™¯</label>
        <textarea id="add-story" placeholder="ãŠåº—ã‚’å§‹ã‚ãŸãã£ã‹ã‘ã‚„èƒŒæ™¯"></textarea>
      </div>

      <div class="form-group">
        <label>ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ</label>
        <textarea id="add-recommendation" placeholder="ãŠå®¢æ§˜ã«ãŠã™ã™ã‚ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆ"></textarea>
      </div>
      
      <!-- ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚° -->
      <div class="form-section">
        <div class="form-section-title">ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°</div>
        <div class="form-group">
          <label>ã‚«ãƒ†ã‚´ãƒªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="category" value="ã‚¹ã‚¤ãƒ¼ãƒ„"> ã‚¹ã‚¤ãƒ¼ãƒ„</label>
            <label><input type="checkbox" name="category" value="é£Ÿäº‹"> é£Ÿäº‹</label>
            <label><input type="checkbox" name="category" value="ãƒ‘ãƒ³"> ãƒ‘ãƒ³</label>
            <label><input type="checkbox" name="category" value="ãƒ‰ãƒªãƒ³ã‚¯"> ãƒ‰ãƒªãƒ³ã‚¯</label>
            <label><input type="checkbox" name="category" value="èª¿å‘³æ–™"> èª¿å‘³æ–™</label>
          </div>
        </div>
        
        <div class="form-group">
          <label>ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="tags" value="å°éº¦ä¸ä½¿ç”¨"> å°éº¦ä¸ä½¿ç”¨</label>
            <label><input type="checkbox" name="tags" value="åµä¸ä½¿ç”¨"> åµä¸ä½¿ç”¨</label>
            <label><input type="checkbox" name="tags" value="ä¹³ä¸ä½¿ç”¨"> ä¹³ä¸ä½¿ç”¨</label>
            <label><input type="checkbox" name="tags" value="ãƒŠãƒƒãƒ„ä¸ä½¿ç”¨"> ãƒŠãƒƒãƒ„ä¸ä½¿ç”¨</label>
            <label><input type="checkbox" name="tags" value="ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ"> ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ</label>
          </div>
        </div>
      </div>
      
      <!-- å†™çœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="form-section">
        <div class="form-section-title">ğŸ“· å†™çœŸ</div>
        
        <div class="form-group">
          <label>ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURL</label>
          <div style="display:flex;gap:10px;align-items:center;">
            <input type="text" id="add-thumb" placeholder="https://user-images.githubusercontent.com/..." style="flex:1;">
            <button type="button" onclick="showImageSelector('thumb')" style="background:#4caf50;color:white;border:none;padding:10px 15px;border-radius:8px;cursor:pointer;">ğŸ“· é¸æŠ</button>
          </div>
          <img id="thumb-preview" style="max-width:200px;max-height:200px;border-radius:8px;margin-top:10px;display:none;">
        </div>
        
        <div class="form-group">
          <label>è¿½åŠ å†™çœŸURLsï¼ˆè¤‡æ•°å¯ã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰</label>
          <textarea id="add-photos" rows="4" placeholder="https://user-images.githubusercontent.com/xxx/yyy.jpg&#10;https://user-images.githubusercontent.com/xxx/zzz.jpg"></textarea>
          <button type="button" onclick="showImageSelector('photos')" style="background:#4caf50;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;margin-top:10px;">ğŸ“· è¤‡æ•°ç”»åƒã‚’é¸æŠ</button>
        </div>
      </div>
      
      <!-- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»ã‚³ãƒ³ã‚¿ãƒŸæƒ…å ± -->
      <div class="form-section">
        <div class="form-section-title">ğŸš¨ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»ã‚³ãƒ³ã‚¿ãƒŸæƒ…å ±</div>
        
        <div class="form-group">
          <label>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±</label>
          <textarea id="add-allergyInfo" placeholder="å«ã¾ã‚Œã‚‹ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ã‚„æ³¨æ„äº‹é …ï¼ˆä¾‹ï¼šåµãƒ»ä¹³è£½å“ï¼‰"></textarea>
        </div>
        
        <div class="form-group">
          <label>ã‚³ãƒ³ã‚¿ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ</label>
          <select id="add-contamination">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="â‘  å°‚ç”¨èª¿ç†å ´ãƒ»å°éº¦ãƒ»éº¦é¡ã‚’ä¸€åˆ‡æŒã¡è¾¼ã¾ãªã„å°‚ç”¨ã®èª¿ç†å ´ã§è£½é€ ">â‘  å°‚ç”¨èª¿ç†å ´ãƒ»å°éº¦ãƒ»éº¦é¡ã‚’ä¸€åˆ‡æŒã¡è¾¼ã¾ãªã„å°‚ç”¨ã®èª¿ç†å ´ã§è£½é€ </option>
            <option value="â‘¢å°éº¦ã‚’æ‰±ã†èª¿ç†å ´ãƒ»æ™®æ®µã¯å°éº¦è£½å“ã‚’æ‰±ã†ç’°å¢ƒã§è£½é€ ">â‘¢å°éº¦ã‚’æ‰±ã†èª¿ç†å ´ãƒ»æ™®æ®µã¯å°éº¦è£½å“ã‚’æ‰±ã†ç’°å¢ƒã§è£½é€ </option>
            <option value="â‘£å°éº¦ç²‰ã¯ä½¿ç”¨ã—ã¦ã„ãªã„ãŒã€å°éº¦ã‚’å«ã‚€èª¿å‘³æ–™ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹èª¿ç†å ´">â‘£å°éº¦ç²‰ã¯ä½¿ç”¨ã—ã¦ã„ãªã„ãŒã€å°éº¦ã‚’å«ã‚€èª¿å‘³æ–™ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹èª¿ç†å ´</option>
          </select>
        </div>
      </div>

      <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ± -->
      <div class="form-section">
        <div class="form-section-title">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±</div>
        <div class="form-group">
          <label>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆJSONå½¢å¼ï¼‰</label>
          <textarea id="add-menu" rows="5" placeholder='[{"name":"å•†å“å1","price":"ä¾¡æ ¼1"},{"name":"å•†å“å2","price":"ä¾¡æ ¼2"}]'></textarea>
          <small style="color:#666;">ä¾‹: [{"name":"ç±³ç²‰ãƒ‘ãƒ³","price":"300å††"},{"name":"ã‚±ãƒ¼ã‚­","price":"500å††"}]</small>
        </div>
      </div>

      <!-- ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ± -->
      <div class="form-section">
        <div class="form-section-title">ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±</div>
        <div class="form-group">
          <label>ä½æ‰€</label>
          <input type="text" id="add-address" placeholder="ä¾‹: æ±äº¬éƒ½æ¸‹è°·åŒº...">
        </div>
        
        <div class="form-group">
          <label>Google Maps URL</label>
          <input type="url" id="add-googleMaps" placeholder="https://maps.google.com/...">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</label>
            <input type="url" id="add-site" placeholder="https://example.com">
          </div>
          <div class="form-group">
            <label>Instagram</label>
            <input type="url" id="add-instagram" placeholder="https://instagram.com/...">
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">ğŸ’¾ ç™»éŒ²ã™ã‚‹</button>
        <button type="button" class="btn btn-gray" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </form>
  </div>
</div>

<!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="edit-modal" class="modal">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h2 style="color:#2c5f2d;">âœï¸ åº—èˆ—æƒ…å ±ç·¨é›†</h2>
      <button class="modal-close" onclick="closeEditModal()">&times;</button>
    </div>
    
    <div style="padding:20px;">
      <!-- ç”»åƒã‚¯ã‚¤ãƒƒã‚¯é¸æŠ -->
      <div style="background:#e8f5e8;border-radius:12px;padding:20px;margin-bottom:30px;">
        <h3 style="color:#2e7d32;margin-bottom:15px;">ğŸ“· ç”»åƒã‚¯ã‚¤ãƒƒã‚¯é¸æŠ</h3>
        <p style="color:#666;margin-bottom:15px;">ç”»åƒãƒªãƒ³ã‚¯é›†ã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€ä¸‹ã®æ¬„ã«ç›´æ¥URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        <button type="button" onclick="showImageSelector('edit')" style="background:#4caf50;color:white;border:none;padding:10px 20px;border-radius:20px;cursor:pointer;">ğŸ“· ç”»åƒãƒªãƒ³ã‚¯é›†ã‹ã‚‰é¸æŠ</button>
      </div>
      
      <form id="edit-form">
        <input type="hidden" id="edit-id">
        
        <!-- åŸºæœ¬æƒ…å ± -->
        <div class="form-section-title">ğŸ“ åŸºæœ¬æƒ…å ±</div>
        <div class="form-row">
          <div class="form-group">
            <label>åº—èˆ—å *</label>
            <input type="text" id="edit-name" required>
          </div>
          <div class="form-group">
            <label>ç°¡æ½”ãªèª¬æ˜</label>
            <input type="text" id="edit-short" placeholder="ä¾‹: ç±³ç²‰ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­ã®å°‚é–€åº—">
          </div>
        </div>
        
        <div class="form-group">
          <label>ã‚³ãƒ³ã‚»ãƒ—ãƒˆ</label>
          <textarea id="edit-concept" placeholder="ãŠåº—ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚„æƒ³ã„"></textarea>
        </div>

        <div class="form-group">
          <label>è©³ç´°èª¬æ˜</label>
          <textarea id="edit-desc" placeholder="ãŠåº—ã®è©³ã—ã„èª¬æ˜"></textarea>
        </div>

        <div class="form-group">
          <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®¢å±¤</label>
          <textarea id="edit-targetCustomer" placeholder="ã©ã®ã‚ˆã†ãªãŠå®¢æ§˜ã«æ¥ã¦ã„ãŸã ããŸã„ã‹"></textarea>
        </div>

        <div class="form-group">
          <label>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ»èƒŒæ™¯</label>
          <textarea id="edit-story" placeholder="ãŠåº—ã‚’å§‹ã‚ãŸãã£ã‹ã‘ã‚„èƒŒæ™¯"></textarea>
        </div>

        <div class="form-group">
          <label>ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ</label>
          <textarea id="edit-recommendation" placeholder="ãŠå®¢æ§˜ã«ãŠã™ã™ã‚ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆ"></textarea>
        </div>
        
        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚° -->
        <div class="form-section">
          <div class="form-section-title">ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°</div>
          <div class="form-group">
            <label>ã‚«ãƒ†ã‚´ãƒªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
            <div class="checkbox-group" id="edit-categories">
              <label><input type="checkbox" name="edit-category" value="ã‚¹ã‚¤ãƒ¼ãƒ„"> ã‚¹ã‚¤ãƒ¼ãƒ„</label>
              <label><input type="checkbox" name="edit-category" value="é£Ÿäº‹"> é£Ÿäº‹</label>
              <label><input type="checkbox" name="edit-category" value="ãƒ‘ãƒ³"> ãƒ‘ãƒ³</label>
              <label><input type="checkbox" name="edit-category" value="ãƒ‰ãƒªãƒ³ã‚¯"> ãƒ‰ãƒªãƒ³ã‚¯</label>
              <label><input type="checkbox" name="edit-category" value="èª¿å‘³æ–™"> èª¿å‘³æ–™</label>
            </div>
          </div>
          
          <div class="form-group">
            <label>ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
            <div class="checkbox-group" id="edit-tags">
              <label><input type="checkbox" name="edit-tags" value="å°éº¦ä¸ä½¿ç”¨"> å°éº¦ä¸ä½¿ç”¨</label>
              <label><input type="checkbox" name="edit-tags" value="åµä¸ä½¿ç”¨"> åµä¸ä½¿ç”¨</label>
              <label><input type="checkbox" name="edit-tags" value="ä¹³ä¸ä½¿ç”¨"> ä¹³ä¸ä½¿ç”¨</label>
              <label><input type="checkbox" name="edit-tags" value="ãƒŠãƒƒãƒ„ä¸ä½¿ç”¨"> ãƒŠãƒƒãƒ„ä¸ä½¿ç”¨</label>
              <label><input type="checkbox" name="edit-tags" value="ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ"> ãƒ´ã‚£ãƒ¼ã‚¬ãƒ³å¯¾å¿œ</label>
            </div>
          </div>
        </div>
        
        <!-- å†™çœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="form-section">
          <div class="form-section-title">ğŸ“· å†™çœŸ</div>
          
          <div class="form-group">
            <label>ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURL</label>
            <div style="display:flex;gap:10px;align-items:center;">
              <input type="text" id="edit-thumb" placeholder="https://user-images.githubusercontent.com/..." style="flex:1;">
              <button type="button" onclick="showImageSelector('edit-thumb')" style="background:#4caf50;color:white;border:none;padding:10px 15px;border-radius:8px;cursor:pointer;">ğŸ“· é¸æŠ</button>
            </div>
            <img id="edit-thumb-preview" style="max-width:200px;max-height:200px;border-radius:8px;margin-top:10px;display:none;">
          </div>
          
          <div class="form-group">
            <label>è¿½åŠ å†™çœŸURLsï¼ˆè¤‡æ•°å¯ã€æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰</label>
            <textarea id="edit-photos" rows="4" placeholder="https://user-images.githubusercontent.com/xxx/yyy.jpg&#10;https://user-images.githubusercontent.com/xxx/zzz.jpg"></textarea>
            <button type="button" onclick="showImageSelector('edit-photos')" style="background:#4caf50;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;margin-top:10px;">ğŸ“· è¤‡æ•°ç”»åƒã‚’é¸æŠ</button>
          </div>
        </div>
        
        <!-- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»ã‚³ãƒ³ã‚¿ãƒŸæƒ…å ± -->
        <div class="form-section">
          <div class="form-section-title">ğŸš¨ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»ã‚³ãƒ³ã‚¿ãƒŸæƒ…å ±</div>
          
          <div class="form-group">
            <label>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±</label>
            <textarea id="edit-allergyInfo" placeholder="å«ã¾ã‚Œã‚‹ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ã‚„æ³¨æ„äº‹é …ï¼ˆä¾‹ï¼šåµãƒ»ä¹³è£½å“ï¼‰"></textarea>
          </div>
          
          <div class="form-group">
            <label>ã‚³ãƒ³ã‚¿ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ</label>
            <select id="edit-contamination">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="â‘  å°‚ç”¨èª¿ç†å ´ãƒ»å°éº¦ãƒ»éº¦é¡ã‚’ä¸€åˆ‡æŒã¡è¾¼ã¾ãªã„å°‚ç”¨ã®èª¿ç†å ´ã§è£½é€ ">â‘  å°‚ç”¨èª¿ç†å ´ãƒ»å°éº¦ãƒ»éº¦é¡ã‚’ä¸€åˆ‡æŒã¡è¾¼ã¾ãªã„å°‚ç”¨ã®èª¿ç†å ´ã§è£½é€ </option>
              <option value="â‘¢å°éº¦ã‚’æ‰±ã†èª¿ç†å ´ãƒ»æ™®æ®µã¯å°éº¦è£½å“ã‚’æ‰±ã†ç’°å¢ƒã§è£½é€ ">â‘¢å°éº¦ã‚’æ‰±ã†èª¿ç†å ´ãƒ»æ™®æ®µã¯å°éº¦è£½å“ã‚’æ‰±ã†ç’°å¢ƒã§è£½é€ </option>
              <option value="â‘£å°éº¦ç²‰ã¯ä½¿ç”¨ã—ã¦ã„ãªã„ãŒã€å°éº¦ã‚’å«ã‚€èª¿å‘³æ–™ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹èª¿ç†å ´">â‘£å°éº¦ç²‰ã¯ä½¿ç”¨ã—ã¦ã„ãªã„ãŒã€å°éº¦ã‚’å«ã‚€èª¿å‘³æ–™ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹èª¿ç†å ´</option>
            </select>
          </div>
        </div>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ± -->
        <div class="form-section">
          <div class="form-section-title">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±</div>
          <div class="form-group">
            <label>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆJSONå½¢å¼ï¼‰</label>
            <textarea id="edit-menu" rows="5" placeholder='[{"name":"å•†å“å1","price":"ä¾¡æ ¼1"},{"name":"å•†å“å2","price":"ä¾¡æ ¼2"}]'></textarea>
            <small style="color:#666;">ä¾‹: [{"name":"ç±³ç²‰ãƒ‘ãƒ³","price":"300å††"},{"name":"ã‚±ãƒ¼ã‚­","price":"500å††"}]</small>
          </div>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ± -->
        <div class="form-section">
          <div class="form-section-title">ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±</div>
          <div class="form-group">
            <label>ä½æ‰€</label>
            <input type="text" id="edit-address" placeholder="ä¾‹: æ±äº¬éƒ½æ¸‹è°·åŒº...">
          </div>
          
          <div class="form-group">
            <label>Google Maps URL</label>
            <input type="url" id="edit-googleMaps" placeholder="https://maps.google.com/...">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</label>
              <input type="url" id="edit-site" placeholder="https://example.com">
            </div>
            <div class="form-group">
              <label>Instagram</label>
              <input type="url" id="edit-instagram" placeholder="https://instagram.com/...">
            </div>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">ğŸ’¾ æ›´æ–°ã™ã‚‹</button>
          <button type="button" class="btn btn-gray" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="image-selector-modal" class="modal">
  <div class="modal-content" style="max-width:1000px;">
    <div class="modal-header">
      <h2 style="color:#2c5f2d;">ğŸ“· ç”»åƒã‚’é¸æŠ</h2>
      <button class="modal-close" onclick="closeImageSelector()">&times;</button>
    </div>
    
    <div style="padding:20px;">
      <p style="margin-bottom:20px;color:#666;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒURLã‚’é¸æŠã—ã¦ãã ã•ã„</p>
      <div id="modal-image-gallery" class="image-gallery"></div>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://gf-fes-api.bettger1000.workers.dev/api';
let shops = [];
let imageLinks = JSON.parse(localStorage.getItem('imageLinks') || '[]');
let currentImageTarget = null;

// åˆæœŸåŒ–
window.onload = function() {
  loadShops();
  displayImageGallery();
  
  document.getElementById('add-form').addEventListener('submit', function(e) {
    e.preventDefault();
    addShop();
  });
  
  // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
  document.getElementById('edit-form').addEventListener('submit', function(e) {
    e.preventDefault();
    updateShop();
  });
  
  // ç·¨é›†ç”»åƒURLå…¥åŠ›æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  document.getElementById('edit-thumb').addEventListener('input', function() {
    const preview = document.getElementById('edit-thumb-preview');
    if (this.value && !this.value.endsWith('.svg')) {
      preview.src = this.value;
      preview.style.display = 'block';
      preview.onerror = function() { this.style.display = 'none'; };
    } else {
      preview.style.display = 'none';
    }
  });
  
  // ç”»åƒURLå…¥åŠ›æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  document.getElementById('add-thumb').addEventListener('input', function() {
    const preview = document.getElementById('thumb-preview');
    if (this.value && !this.value.endsWith('.svg')) {
      preview.src = this.value;
      preview.style.display = 'block';
      preview.onerror = function() { this.style.display = 'none'; };
    } else {
      preview.style.display = 'none';
    }
  });
};

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
function showSection(section) {
  document.getElementById('section-list').style.display = section === 'list' ? 'block' : 'none';
  document.getElementById('section-add').style.display = section === 'add' ? 'block' : 'none';
  document.getElementById('section-images').style.display = section === 'images' ? 'block' : 'none';
  
  if (section === 'list') {
    loadShops();
  } else if (section === 'images') {
    displayImageGallery();
  }
}

// ç”»åƒãƒªãƒ³ã‚¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¡¨ç¤º
function displayImageGallery() {
  const gallery = document.getElementById('image-gallery');
  const stats = document.getElementById('image-count');
  
  stats.textContent = imageLinks.length;
  
  if (imageLinks.length === 0) {
    gallery.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#666;font-size:18px;padding:40px;">ã¾ã ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“<br><br>ä¸Šã®ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦GitHub Issuesã§ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</p>';
    return;
  }
  
  gallery.innerHTML = imageLinks.map((url, index) => `
    <div class="image-item">
      <img src="${url}" alt="ç”»åƒ ${index + 1}" class="image-preview" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22120%22 viewBox=%220 0 200 120%22%3E%3Crect width=%22200%22 height=%22120%22 fill=%22%23ddd%22/%3E%3Ctext x=%22100%22 y=%2260%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eç”»åƒã‚¨ãƒ©ãƒ¼%3C/text%3E%3C/svg%3E'">
      <div class="image-info">
        <div class="image-url">${url}</div>
        <div class="image-actions">
          <button class="btn-copy" onclick="copyToClipboard('${url}', this)">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
          <button class="btn-remove-img" onclick="removeImageLink(${index})">ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>
      </div>
    </div>
  `).join('');
}

// æ‰‹å‹•URLè¿½åŠ 
function addManualURL() {
  const input = document.getElementById('manual-url-input');
  const url = input.value.trim();
  
  if (!url) {
    alert('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  if (!url.includes('user-images.githubusercontent.com') && !url.startsWith('http')) {
    alert('æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nï¼ˆhttps://user-images.githubusercontent.com/ ã§å§‹ã¾ã‚‹URLï¼‰');
    return;
  }
  
  if (imageLinks.includes(url)) {
    alert('ã“ã®ç”»åƒã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
    return;
  }
  
  imageLinks.push(url);
  localStorage.setItem('imageLinks', JSON.stringify(imageLinks));
  input.value = '';
  displayImageGallery();
  showCopySuccess('ç”»åƒãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
}

// ç”»åƒãƒªãƒ³ã‚¯å‰Šé™¤
function removeImageLink(index) {
  if (confirm('ã“ã®ç”»åƒãƒªãƒ³ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
    imageLinks.splice(index, 1);
    localStorage.setItem('imageLinks', JSON.stringify(imageLinks));
    displayImageGallery();
  }
}

// ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
function copyToClipboard(text, button) {
  navigator.clipboard.then ? navigator.clipboard.writeText(text).then(() => {
    const originalText = button.innerHTML;
    button.innerHTML = 'âœ… ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
    button.classList.add('copied');
    setTimeout(() => {
      button.innerHTML = originalText;
      button.classList.remove('copied');
    }, 2000);
    showCopySuccess('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
  }) : (() => {
    // Fallback for older browsers
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showCopySuccess('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
  })();
}

// ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showEditModal(shop) {
  document.getElementById('edit-id').value = shop.id.toString();
  document.getElementById('edit-name').value = shop.name || '';
  document.getElementById('edit-short').value = shop.short || '';
  document.getElementById('edit-concept').value = shop.concept || '';
  document.getElementById('edit-desc').value = shop.desc || '';
  document.getElementById('edit-targetCustomer').value = shop.targetCustomer || '';
  document.getElementById('edit-story').value = shop.story || '';
  document.getElementById('edit-recommendation').value = shop.recommendation || '';
  document.getElementById('edit-address').value = shop.address || '';
  document.getElementById('edit-googleMaps').value = shop.googleMaps || '';
  document.getElementById('edit-thumb').value = shop.thumb || '';
  document.getElementById('edit-photos').value = shop.photos ? shop.photos.join('\n') : '';
  document.getElementById('edit-site').value = shop.links?.site || '';
  document.getElementById('edit-instagram').value = shop.links?.instagram || '';
  document.getElementById('edit-allergyInfo').value = Array.isArray(shop.allergyInfo) ? shop.allergyInfo.join(', ') : (shop.allergyInfo || '');
  document.getElementById('edit-contamination').value = shop.contamination || '';
  document.getElementById('edit-menu').value = shop.menu ? JSON.stringify(shop.menu, null, 2) : '';
  
  // ã‚µãƒ ãƒã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š
  const preview = document.getElementById('edit-thumb-preview');
  if (shop.thumb && !shop.thumb.endsWith('.svg')) {
    preview.src = shop.thumb;
    preview.style.display = 'block';
  } else {
    preview.style.display = 'none';
  }
  
  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
  document.querySelectorAll('#edit-modal input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
  });
  
  // ã‚«ãƒ†ã‚´ãƒªã‚’è¨­å®š
  if (shop.category) {
    shop.category.forEach(cat => {
      const cb = document.querySelector(`input[name="edit-category"][value="${cat}"]`);
      if (cb) cb.checked = true;
    });
  }
  
  // ã‚¿ã‚°ã‚’è¨­å®š
  if (shop.tags) {
    shop.tags.forEach(tag => {
      const cb = document.querySelector(`input[name="edit-tags"][value="${tag}"]`);
      if (cb) cb.checked = true;
    });
  }
  
  document.getElementById('edit-modal').style.display = 'block';
}

// ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeEditModal() {
  document.getElementById('edit-modal').style.display = 'none';
}

// ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showImageSelector(target) {
  currentImageTarget = target;
  const modal = document.getElementById('image-selector-modal');
  const gallery = document.getElementById('modal-image-gallery');
  
  if (imageLinks.length === 0) {
    alert('ã¾ãšç”»åƒãƒªãƒ³ã‚¯é›†ã§ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„');
    showSection('images');
    return;
  }
  
  gallery.innerHTML = imageLinks.map((url, index) => `
    <div class="image-item" onclick="selectImage('${url}')" style="cursor:pointer;">
      <img src="${url}" alt="ç”»åƒ ${index + 1}" class="image-preview">
      <div class="image-info">
        <div style="text-align:center;padding:10px;">
          <button class="btn-copy" onclick="event.stopPropagation(); selectImage('${url}')">âœ… ã“ã®ç”»åƒã‚’é¸æŠ</button>
        </div>
      </div>
    </div>
  `).join('');
  
  modal.style.display = 'block';
}

// ç”»åƒé¸æŠ
function selectImage(url) {
  if (currentImageTarget === 'thumb') {
    document.getElementById('add-thumb').value = url;
    document.getElementById('thumb-preview').src = url;
    document.getElementById('thumb-preview').style.display = 'block';
  } else if (currentImageTarget === 'photos') {
    const textarea = document.getElementById('add-photos');
    textarea.value += (textarea.value ? '\n' : '') + url;
  } else if (currentImageTarget === 'edit-thumb') {
    document.getElementById('edit-thumb').value = url;
    document.getElementById('edit-thumb-preview').src = url;
    document.getElementById('edit-thumb-preview').style.display = 'block';
  } else if (currentImageTarget === 'edit-photos') {
    const textarea = document.getElementById('edit-photos');
    textarea.value += (textarea.value ? '\n' : '') + url;
  }
  closeImageSelector();
  showCopySuccess('ç”»åƒã‚’é¸æŠã—ã¾ã—ãŸï¼');
}

// ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeImageSelector() {
  document.getElementById('image-selector-modal').style.display = 'none';
  currentImageTarget = null;
}

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
function showCopySuccess(message) {
  const successDiv = document.createElement('div');
  successDiv.className = 'copy-success';
  successDiv.textContent = message;
  document.body.appendChild(successDiv);
  setTimeout(() => document.body.removeChild(successDiv), 2000);
}

// åº—èˆ—ä¸€è¦§èª­ã¿è¾¼ã¿
function loadShops() {
  const statusDiv = document.getElementById('status');
  statusDiv.innerHTML = '<span class="loading"></span>åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...';
  
  fetch(API_BASE + '/shops', {
    method: 'GET',
    mode: 'cors',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    }
  })
    .then(response => {
      console.log('Response status:', response.status);
      console.log('Response headers:', response.headers);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log('Data loaded successfully:', data.length, 'shops');
      shops = data;
      displayShops();
    })
    .catch(error => {
      console.error('è©³ç´°ã‚¨ãƒ©ãƒ¼:', error);
      statusDiv.innerHTML = `<span class="error">âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</span><br><small>è©³ç´°ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>`;
    });
}

// åº—èˆ—ä¸€è¦§è¡¨ç¤º
function displayShops() {
  const statusDiv = document.getElementById('status');
  const gridDiv = document.getElementById('shops-grid');
  
  if (!shops || shops.length === 0) {
    statusDiv.innerHTML = '<span class="error">ç™»éŒ²æ¸ˆã¿åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</span>';
    gridDiv.innerHTML = '';
    return;
  }
  
  statusDiv.innerHTML = `<span class="success">âœ… ${shops.length}ä»¶ã®åº—èˆ—ã‚’ç®¡ç†ä¸­</span>`;
  
  let html = '';
  shops.forEach(shop => {
    html += `
      <div class="shop-card">
        ${shop.thumb && !shop.thumb.endsWith('.svg') ? `<img src="${shop.thumb}" alt="${shop.name}" class="shop-thumb" onerror="this.style.display='none'">` : ''}
        <h3>${shop.name || 'åå‰æœªè¨­å®š'}</h3>
        ${shop.short ? `<div class="shop-info">ğŸ“ ${shop.short}</div>` : ''}
        ${shop.address ? `<div class="shop-info">ğŸ“ ${shop.address}</div>` : ''}
        ${shop.category && shop.category.length ? `<div class="shop-info">ğŸ·ï¸ ${shop.category.join(', ')}</div>` : ''}
        ${shop.tags && shop.tags.length ? `<div class="shop-info">ğŸ”– ${shop.tags.join(', ')}</div>` : ''}
        <div class="shop-actions">
          <button class="btn-edit" onclick="editShop('${shop.id}')">âœï¸ ç·¨é›†</button>
          <button class="btn-delete" onclick="deleteShop('${shop.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>
      </div>
    `;
  });
  
  gridDiv.innerHTML = html;
}

// æ–°è¦åº—èˆ—è¿½åŠ 
function addShop() {
  const name = document.getElementById('add-name').value.trim();
  if (!name) {
    alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  const categories = [];
  document.querySelectorAll('input[name="category"]:checked').forEach(cb => {
    categories.push(cb.value);
  });
  
  const tags = [];
  document.querySelectorAll('input[name="tags"]:checked').forEach(cb => {
    tags.push(cb.value);
  });
  
  const photosText = document.getElementById('add-photos').value.trim();
  const photos = photosText ? photosText.split('\n').map(p => p.trim()).filter(p => p) : [];
  
  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®JSONãƒ‘ãƒ¼ã‚¹
  let menu = [];
  const menuText = document.getElementById('add-menu').value.trim();
  if (menuText) {
    try {
      menu = JSON.parse(menuText);
    } catch (e) {
      alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã®JSONå½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
      return;
    }
  }
  
  // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã®å‡¦ç†
  const allergyInfoText = document.getElementById('add-allergyInfo').value.trim();
  const allergyInfo = allergyInfoText ? allergyInfoText.split(',').map(item => item.trim()).filter(item => item) : [];
  
  const shopData = {
    name: name,
    short: document.getElementById('add-short').value.trim(),
    concept: document.getElementById('add-concept').value.trim(),
    desc: document.getElementById('add-desc').value.trim(),
    targetCustomer: document.getElementById('add-targetCustomer').value.trim(),
    story: document.getElementById('add-story').value.trim(),
    recommendation: document.getElementById('add-recommendation').value.trim(),
    category: categories,
    tags: tags,
    address: document.getElementById('add-address').value.trim(),
    googleMaps: document.getElementById('add-googleMaps').value.trim(),
    thumb: document.getElementById('add-thumb').value.trim(),
    photos: photos,
    allergyInfo: allergyInfo,
    contamination: document.getElementById('add-contamination').value.trim(),
    menu: menu,
    links: {
      site: document.getElementById('add-site').value.trim(),
      instagram: document.getElementById('add-instagram').value.trim()
    }
  };
  
  fetch(API_BASE + '/shops', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(shopData)
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
      resetForm();
      showSection('list');
    } else {
      alert('âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}

// åº—èˆ—ç·¨é›†
function editShop(id) {
  const shop = shops.find(s => s.id === id);
  if (!shop) return;
  
  // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  showEditModal(shop);
}

// åº—èˆ—å‰Šé™¤
function deleteShop(id) {
  const shop = shops.find(s => s.id === id);
  if (!shop) return;
  
  if (!confirm(`ã€Œ${shop.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
    return;
  }
  
  fetch(API_BASE + '/shops/' + id.split(':')[0], {
    method: 'DELETE'
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
      loadShops();
    } else {
      alert('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}

// ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
function resetForm() {
  document.getElementById('add-form').reset();
  document.getElementById('thumb-preview').style.display = 'none';
}

// ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
function exportData() {
  if (!shops || shops.length === 0) {
    alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
    return;
  }
  
  const jsonStr = JSON.stringify(shops, null, 2);
  const blob = new Blob([jsonStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = 'shops-' + new Date().toISOString().slice(0,10) + '.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert(`âœ… ${shops.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
}

// ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedShops = JSON.parse(e.target.result);
      if (!Array.isArray(importedShops)) {
        alert('âŒ ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
        return;
      }
      
      if (confirm(`${importedShops.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ\næ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚`)) {
        let successCount = 0;
        let promises = importedShops.map(shop => {
          return fetch(API_BASE + '/shops', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(shop)
          })
          .then(response => {
            if (response.ok) successCount++;
          })
          .catch(error => console.error('Import error:', error));
        });
        
        Promise.all(promises).then(() => {
          alert(`âœ… ${successCount}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
          loadShops();
        });
      }
    } catch (error) {
      alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      console.error('Import error:', error);
    }
  };
  
  reader.readAsText(file);
  event.target.value = '';
}

// åº—èˆ—æ›´æ–°
function updateShop() {
  const id = document.getElementById('edit-id').value.split(':')[0];
  const name = document.getElementById('edit-name').value.trim();
  
  if (!name) {
    alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  
  const categories = [];
  document.querySelectorAll('input[name="edit-category"]:checked').forEach(cb => {
    categories.push(cb.value);
  });
  
  const tags = [];
  document.querySelectorAll('input[name="edit-tags"]:checked').forEach(cb => {
    tags.push(cb.value);
  });
  
  const photosText = document.getElementById('edit-photos').value.trim();
  const photos = photosText ? photosText.split('\n').map(p => p.trim()).filter(p => p) : [];
  
  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®JSONãƒ‘ãƒ¼ã‚¹
  let menu = [];
  const menuText = document.getElementById('edit-menu').value.trim();
  if (menuText) {
    try {
      menu = JSON.parse(menuText);
    } catch (e) {
      alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã®JSONå½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
      return;
    }
  }
  
  // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã®å‡¦ç†
  const allergyInfoText = document.getElementById('edit-allergyInfo').value.trim();
  const allergyInfo = allergyInfoText ? allergyInfoText.split(',').map(item => item.trim()).filter(item => item) : [];
  
  const shopData = {
    name: name,
    short: document.getElementById('edit-short').value.trim(),
    concept: document.getElementById('edit-concept').value.trim(),
    desc: document.getElementById('edit-desc').value.trim(),
    targetCustomer: document.getElementById('edit-targetCustomer').value.trim(),
    story: document.getElementById('edit-story').value.trim(),
    recommendation: document.getElementById('edit-recommendation').value.trim(),
    category: categories,
    tags: tags,
    address: document.getElementById('edit-address').value.trim(),
    googleMaps: document.getElementById('edit-googleMaps').value.trim(),
    thumb: document.getElementById('edit-thumb').value.trim(),
    photos: photos,
    allergyInfo: allergyInfo,
    contamination: document.getElementById('edit-contamination').value.trim(),
    menu: menu,
    links: {
      site: document.getElementById('edit-site').value.trim(),
      instagram: document.getElementById('edit-instagram').value.trim()
    }
  };
  
  fetch(API_BASE + '/shops/' + id, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(shopData)
  })
  .then(response => {
    if (response.ok) {
      alert('âœ… åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
      closeEditModal();
      loadShops();
    } else {
      alert('âŒ æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  });
}
</script>

</body>
</html>