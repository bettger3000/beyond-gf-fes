<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åº—èˆ—ç®¡ç†ç”»é¢ - ãƒ“ãƒ¨ãƒ³ãƒ‰ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ç¥­ã‚Š</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #F5F3F0;
      color: #2C2C2C;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #4A5D4F;
      margin-bottom: 30px;
      font-size: 2rem;
    }

    .nav {
      text-align: center;
      margin-bottom: 30px;
    }

    .nav button {
      background: #4A5D4F;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 1rem;
    }

    .nav button.active {
      background: #D4634A;
    }

    .nav button:hover {
      background: #B8985A;
    }

    .section {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .section.active {
      display: block;
    }

    .shop-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .shop-card {
      background: #fff;
      border: 2px solid #E8E0D6;
      border-radius: 8px;
      padding: 20px;
    }

    .shop-card:hover {
      border-color: #B8985A;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .shop-name {
      font-size: 1.2rem;
      font-weight: bold;
      color: #4A5D4F;
      margin-bottom: 10px;
    }

    .shop-info {
      color: #6B6B6B;
      font-size: 0.9rem;
      margin: 5px 0;
    }

    .shop-concept {
      margin-top: 10px;
      font-style: italic;
      color: #2C2C2C;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .shop-thumb {
      width: 100%;
      max-height: 150px;
      object-fit: cover;
      border-radius: 5px;
      margin-top: 10px;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.2rem;
      color: #6B6B6B;
    }

    .error {
      background: #fee;
      color: #ef4444;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
    }

    .btn {
      background: #4A5D4F;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 1rem;
    }

    .btn:hover {
      background: #B8985A;
    }

    .debug {
      background: #f0f0f0;
      padding: 10px;
      margin-top: 20px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <h1>åº—èˆ—ç®¡ç†ç”»é¢</h1>
  
  <div class="nav">
    <button class="nav-btn active" onclick="showSection('list')">åº—èˆ—ä¸€è¦§</button>
    <button class="nav-btn" onclick="showSection('export')">ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</button>
    <button class="nav-btn" onclick="showSection('debug')">ãƒ‡ãƒãƒƒã‚°</button>
  </div>

  <div id="list" class="section active">
    <h2>ç™»éŒ²æ¸ˆã¿åº—èˆ—ä¸€è¦§</h2>
    <div id="shopsList" class="shop-list">
      <div class="loading">åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
  </div>

  <div id="export" class="section">
    <h2>ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</h2>
    <p>åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
    <br>
    <button class="btn" onclick="exportShopData()">JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </div>

  <div id="debug" class="section">
    <h2>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h2>
    <div id="debugInfo" class="debug">
      <p>APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: https://gf-fes-api.bettger1000.workers.dev/api/shops</p>
      <p id="debugStatus">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å¾…æ©Ÿä¸­</p>
      <p id="debugCount">åº—èˆ—æ•°: -</p>
      <p id="debugError">ã‚¨ãƒ©ãƒ¼: ãªã—</p>
    </div>
    <br>
    <button class="btn" onclick="testAPI()">APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
  </div>

  <script>
    // åˆæœŸåŒ–
    let shopData = [];
    const API_URL = 'https://gf-fes-api.bettger1000.workers.dev/api/shops';

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
    document.addEventListener('DOMContentLoaded', function() {
      console.log('[ç®¡ç†ç”»é¢] åˆæœŸåŒ–é–‹å§‹');
      fetchShops();
    });

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
    function showSection(sectionId) {
      // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
      document.querySelectorAll('.section').forEach(s => {
        s.classList.remove('active');
      });
      
      // ã™ã¹ã¦ã®ãƒŠãƒ“ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
      document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.remove('active');
      });
      
      // é¸æŠã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.add('active');
      }
      
      // å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      event.target.classList.add('active');
    }

    // åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function fetchShops() {
      const container = document.getElementById('shopsList');
      updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
      
      try {
        console.log('[API] å–å¾—é–‹å§‹:', API_URL);
        
        const response = await fetch(API_URL);
        console.log('[API] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
        
        if (!response.ok) {
          throw new Error('HTTPã‚¨ãƒ©ãƒ¼: ' + response.status);
        }
        
        const shops = await response.json();
        console.log('[API] å–å¾—æˆåŠŸ! åº—èˆ—æ•°:', shops.length);
        
        shopData = shops;
        updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'å–å¾—æˆåŠŸ');
        updateDebug('åº—èˆ—æ•°', shops.length);
        
        displayShops(shops);
        
      } catch (error) {
        console.error('[API] ã‚¨ãƒ©ãƒ¼:', error);
        updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'ã‚¨ãƒ©ãƒ¼');
        updateDebug('ã‚¨ãƒ©ãƒ¼', error.message);
        
        container.innerHTML = `
          <div class="error">
            ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br>
            ã‚¨ãƒ©ãƒ¼: ${error.message}
          </div>
        `;
      }
    }

    // åº—èˆ—ä¸€è¦§è¡¨ç¤º
    function displayShops(shops) {
      const container = document.getElementById('shopsList');
      
      if (!shops || shops.length === 0) {
        container.innerHTML = '<div class="error">è¡¨ç¤ºã™ã‚‹åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      const html = shops.map(shop => {
        const categories = Array.isArray(shop.category) ? shop.category.join(', ') : 'æœªè¨­å®š';
        const thumb = shop.thumb ? getImageUrl(shop.thumb) : '';
        
        return `
          <div class="shop-card">
            <div class="shop-name">${shop.name || 'åç§°æœªè¨­å®š'}</div>
            <div class="shop-info">ğŸ“ ${shop.address || 'ä½æ‰€æœªè¨­å®š'}</div>
            <div class="shop-info">ğŸ·ï¸ ${categories}</div>
            ${shop.concept ? `<div class="shop-concept">"${shop.concept}"</div>` : ''}
            ${thumb ? `<img src="${thumb}" class="shop-thumb" alt="${shop.name}" onerror="this.style.display='none'">` : ''}
          </div>
        `;
      }).join('');
      
      container.innerHTML = html;
      console.log('[è¡¨ç¤º] å®Œäº†');
    }

    // ç”»åƒURLã‚’å–å¾—
    function getImageUrl(path) {
      if (!path) return '';
      if (path.startsWith('http')) return path;
      
      // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ãƒã‚§ãƒƒã‚¯
      if (path.match(/\.(svg|png|jpg|jpeg|webp|gif)$/i)) {
        return 'https://gf-fes-api.bettger1000.workers.dev/api/image/' + path;
      }
      
      return path;
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportShopData() {
      if (shopData.length === 0) {
        alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«åº—èˆ—ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      const json = JSON.stringify(shopData, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'shops_' + new Date().toISOString().slice(0,10) + '.json';
      a.click();
      
      URL.revokeObjectURL(url);
      console.log('[ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ] å®Œäº†');
    }

    // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
    async function testAPI() {
      updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'ãƒ†ã‚¹ãƒˆä¸­...');
      
      try {
        const startTime = Date.now();
        const response = await fetch(API_URL);
        const responseTime = Date.now() - startTime;
        
        const data = await response.json();
        
        updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'æ¥ç¶šæˆåŠŸ');
        updateDebug('åº—èˆ—æ•°', data.length);
        updateDebug('ã‚¨ãƒ©ãƒ¼', `ãªã— (å¿œç­”æ™‚é–“: ${responseTime}ms)`);
        
        alert(`APIæ¥ç¶šæˆåŠŸ!\nåº—èˆ—æ•°: ${data.length}\nå¿œç­”æ™‚é–“: ${responseTime}ms`);
        
      } catch (error) {
        updateDebug('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'æ¥ç¶šå¤±æ•—');
        updateDebug('ã‚¨ãƒ©ãƒ¼', error.message);
        alert('APIæ¥ç¶šå¤±æ•—: ' + error.message);
      }
    }

    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
    function updateDebug(type, value) {
      const mapping = {
        'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹': 'debugStatus',
        'åº—èˆ—æ•°': 'debugCount',
        'ã‚¨ãƒ©ãƒ¼': 'debugError'
      };
      
      const elementId = mapping[type];
      if (elementId) {
        const element = document.getElementById(elementId);
        if (element) {
          if (type === 'åº—èˆ—æ•°') {
            element.textContent = `åº—èˆ—æ•°: ${value}`;
          } else if (type === 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹') {
            element.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${value}`;
          } else if (type === 'ã‚¨ãƒ©ãƒ¼') {
            element.textContent = `ã‚¨ãƒ©ãƒ¼: ${value}`;
          }
        }
      }
    }
  </script>
</body>
</html>